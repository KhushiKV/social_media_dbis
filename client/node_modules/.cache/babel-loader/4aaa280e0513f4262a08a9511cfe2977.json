{"ast":null,"code":"const api = require('./api');\n\nconst {\n  isEmpty,\n  isNumber\n} = require('../utils');\n\nconst Search = class Search {\n  constructor() {\n    this.query_hash = {\n      sort_by: [],\n      aggregate: [],\n      with_field: []\n    };\n  }\n\n  static instance() {\n    return new Search();\n  }\n\n  static expression(value) {\n    return this.instance().expression(value);\n  }\n\n  static max_results(value) {\n    return this.instance().max_results(value);\n  }\n\n  static next_cursor(value) {\n    return this.instance().next_cursor(value);\n  }\n\n  static aggregate(value) {\n    return this.instance().aggregate(value);\n  }\n\n  static with_field(value) {\n    return this.instance().with_field(value);\n  }\n\n  static sort_by(field_name) {\n    let dir = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'asc';\n    return this.instance().sort_by(field_name, dir);\n  }\n\n  expression(value) {\n    this.query_hash.expression = value;\n    return this;\n  }\n\n  max_results(value) {\n    this.query_hash.max_results = value;\n    return this;\n  }\n\n  next_cursor(value) {\n    this.query_hash.next_cursor = value;\n    return this;\n  }\n\n  aggregate(value) {\n    const found = this.query_hash.aggregate.find(v => v === value);\n\n    if (!found) {\n      this.query_hash.aggregate.push(value);\n    }\n\n    return this;\n  }\n\n  with_field(value) {\n    const found = this.query_hash.with_field.find(v => v === value);\n\n    if (!found) {\n      this.query_hash.with_field.push(value);\n    }\n\n    return this;\n  }\n\n  sort_by(field_name) {\n    let dir = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"desc\";\n    let sort_bucket;\n    sort_bucket = {};\n    sort_bucket[field_name] = dir; // Check if this field name is already stored in the hash\n\n    const previously_sorted_obj = this.query_hash.sort_by.find(sort_by => sort_by[field_name]); // Since objects are references in Javascript, we can update the reference we found\n    // For example,\n\n    if (previously_sorted_obj) {\n      previously_sorted_obj[field_name] = dir;\n    } else {\n      this.query_hash.sort_by.push(sort_bucket);\n    }\n\n    return this;\n  }\n\n  to_query() {\n    Object.keys(this.query_hash).forEach(k => {\n      let v = this.query_hash[k];\n\n      if (!isNumber(v) && isEmpty(v)) {\n        delete this.query_hash[k];\n      }\n    });\n    return this.query_hash;\n  }\n\n  execute(options, callback) {\n    if (callback === null) {\n      callback = options;\n    }\n\n    options = options || {};\n    return api.search(this.to_query(), options, callback);\n  }\n\n};\nmodule.exports = Search;","map":{"version":3,"names":["api","require","isEmpty","isNumber","Search","constructor","query_hash","sort_by","aggregate","with_field","instance","expression","value","max_results","next_cursor","field_name","dir","found","find","v","push","sort_bucket","previously_sorted_obj","to_query","Object","keys","forEach","k","execute","options","callback","search","module","exports"],"sources":["/Users/abhinavkumar/Desktop/dbms/client/node_modules/cloudinary/lib/v2/search.js"],"sourcesContent":["const api = require('./api');\nconst {isEmpty, isNumber} = require('../utils');\n\nconst Search = class Search {\n  constructor() {\n    this.query_hash = {\n      sort_by: [],\n      aggregate: [],\n      with_field: []\n    };\n  }\n\n  static instance() {\n    return new Search();\n  }\n\n  static expression(value) {\n    return this.instance().expression(value);\n  }\n\n  static max_results(value) {\n    return this.instance().max_results(value);\n  }\n\n  static next_cursor(value) {\n    return this.instance().next_cursor(value);\n  }\n\n  static aggregate(value) {\n    return this.instance().aggregate(value);\n  }\n\n  static with_field(value) {\n    return this.instance().with_field(value);\n  }\n\n  static sort_by(field_name, dir = 'asc') {\n    return this.instance().sort_by(field_name, dir);\n  }\n\n  expression(value) {\n    this.query_hash.expression = value;\n    return this;\n  }\n\n  max_results(value) {\n    this.query_hash.max_results = value;\n    return this;\n  }\n\n  next_cursor(value) {\n    this.query_hash.next_cursor = value;\n    return this;\n  }\n\n  aggregate(value) {\n    const found = this.query_hash.aggregate.find(v => v === value);\n\n    if (!found) {\n      this.query_hash.aggregate.push(value);\n    }\n\n    return this;\n  }\n\n  with_field(value) {\n    const found = this.query_hash.with_field.find(v => v === value);\n\n    if (!found) {\n      this.query_hash.with_field.push(value);\n    }\n\n    return this;\n  }\n\n  sort_by(field_name, dir = \"desc\") {\n    let sort_bucket;\n    sort_bucket = {};\n    sort_bucket[field_name] = dir;\n\n    // Check if this field name is already stored in the hash\n    const previously_sorted_obj = this.query_hash.sort_by.find((sort_by) => sort_by[field_name]);\n\n    // Since objects are references in Javascript, we can update the reference we found\n    // For example,\n    if (previously_sorted_obj) {\n      previously_sorted_obj[field_name] = dir;\n    } else {\n      this.query_hash.sort_by.push(sort_bucket);\n    }\n\n    return this;\n  }\n\n  to_query() {\n    Object.keys(this.query_hash).forEach((k) => {\n      let v = this.query_hash[k];\n      if (!isNumber(v) && isEmpty(v)) {\n        delete this.query_hash[k];\n      }\n    });\n    return this.query_hash;\n  }\n\n  execute(options, callback) {\n    if (callback === null) {\n      callback = options;\n    }\n    options = options || {};\n    return api.search(this.to_query(), options, callback);\n  }\n};\n\nmodule.exports = Search;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}