{"ast":null,"code":"'use strict'; // eslint-disable-next-line import/order\n\nvar config = require(\"../config\");\n\nvar https = /^http:/.test(config().upload_prefix) ? require('http') : require('https');\n\nvar querystring = require(\"querystring\");\n\nvar Q = require('q');\n\nvar url = require('url');\n\nvar utils = require(\"../utils\");\n\nvar ensureOption = require('../utils/ensureOption').defaults(config());\n\nvar ProxyAgent = utils.optionalRequire('proxy-agent');\nvar extend = utils.extend,\n    includes = utils.includes,\n    isEmpty = utils.isEmpty;\n\nfunction execute_request(method, params, auth, api_url, callback) {\n  var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n  method = method.toUpperCase();\n  var deferred = Q.defer();\n  var query_params = void 0,\n      handle_response = void 0; // declare to user later\n\n  var key = auth.key;\n  var secret = auth.secret;\n  var oauth_token = auth.oauth_token;\n  var content_type = 'application/x-www-form-urlencoded';\n\n  if (options.content_type === 'json') {\n    query_params = JSON.stringify(params);\n    content_type = 'application/json';\n  } else {\n    query_params = querystring.stringify(params);\n  }\n\n  if (method === \"GET\") {\n    api_url += \"?\" + query_params;\n  }\n\n  var request_options = url.parse(api_url);\n  request_options = extend(request_options, {\n    method: method,\n    headers: {\n      'Content-Type': content_type,\n      'User-Agent': utils.getUserAgent()\n    }\n  });\n\n  if (oauth_token) {\n    request_options.headers.Authorization = `Bearer ${oauth_token}`;\n  } else {\n    request_options.auth = key + \":\" + secret;\n  }\n\n  if (options.agent != null) {\n    request_options.agent = options.agent;\n  }\n\n  var proxy = options.api_proxy || config().api_proxy;\n\n  if (!isEmpty(proxy)) {\n    if (!request_options.agent) {\n      if (ProxyAgent === null) {\n        throw new Error(\"Proxy value is set, but `proxy-agent` is not installed, please install `proxy-agent` module.\");\n      }\n\n      request_options.agent = new ProxyAgent(proxy);\n    } else {\n      console.warn(\"Proxy is set, but request uses a custom agent, proxy is ignored.\");\n    }\n  }\n\n  if (method !== \"GET\") {\n    request_options.headers['Content-Length'] = Buffer.byteLength(query_params);\n  }\n\n  handle_response = function handle_response(res) {\n    if (includes([200, 400, 401, 403, 404, 409, 420, 500], res.statusCode)) {\n      var buffer = \"\";\n      var error = false;\n      res.on(\"data\", function (d) {\n        buffer += d;\n        return buffer;\n      });\n      res.on(\"end\", function () {\n        var result = void 0;\n\n        if (error) {\n          return;\n        }\n\n        try {\n          result = JSON.parse(buffer);\n        } catch (e) {\n          result = {\n            error: {\n              message: \"Server return invalid JSON response. Status Code \" + res.statusCode\n            }\n          };\n        }\n\n        if (result.error) {\n          result.error.http_code = res.statusCode;\n        } else {\n          result.rate_limit_allowed = parseInt(res.headers[\"x-featureratelimit-limit\"]);\n          result.rate_limit_reset_at = new Date(res.headers[\"x-featureratelimit-reset\"]);\n          result.rate_limit_remaining = parseInt(res.headers[\"x-featureratelimit-remaining\"]);\n        }\n\n        if (result.error) {\n          deferred.reject(Object.assign({\n            request_options,\n            query_params\n          }, result));\n        } else {\n          deferred.resolve(result);\n        }\n\n        if (typeof callback === \"function\") {\n          callback(result);\n        }\n      });\n      res.on(\"error\", function (e) {\n        error = true;\n        var err_obj = {\n          error: {\n            message: e,\n            http_code: res.statusCode,\n            request_options,\n            query_params\n          }\n        };\n        deferred.reject(err_obj.error);\n\n        if (typeof callback === \"function\") {\n          callback(err_obj);\n        }\n      });\n    } else {\n      var err_obj = {\n        error: {\n          message: \"Server returned unexpected status code - \" + res.statusCode,\n          http_code: res.statusCode,\n          request_options,\n          query_params\n        }\n      };\n      deferred.reject(err_obj.error);\n\n      if (typeof callback === \"function\") {\n        callback(err_obj);\n      }\n    }\n  };\n\n  var request = https.request(request_options, handle_response);\n  request.on(\"error\", function (e) {\n    deferred.reject(e);\n    return typeof callback === \"function\" ? callback({\n      error: e\n    }) : void 0;\n  });\n  request.setTimeout(ensureOption(options, \"timeout\", 60000));\n\n  if (method !== \"GET\") {\n    request.write(query_params);\n  }\n\n  request.end();\n  return deferred.promise;\n}\n\nmodule.exports = execute_request;","map":{"version":3,"names":["config","require","https","test","upload_prefix","querystring","Q","url","utils","ensureOption","defaults","ProxyAgent","optionalRequire","extend","includes","isEmpty","execute_request","method","params","auth","api_url","callback","options","arguments","length","undefined","toUpperCase","deferred","defer","query_params","handle_response","key","secret","oauth_token","content_type","JSON","stringify","request_options","parse","headers","getUserAgent","Authorization","agent","proxy","api_proxy","Error","console","warn","Buffer","byteLength","res","statusCode","buffer","error","on","d","result","e","message","http_code","rate_limit_allowed","parseInt","rate_limit_reset_at","Date","rate_limit_remaining","reject","Object","assign","resolve","err_obj","request","setTimeout","write","end","promise","module","exports"],"sources":["/Users/abhinavkumar/Desktop/dbms/client/node_modules/cloudinary/lib-es5/api_client/execute_request.js"],"sourcesContent":["'use strict';\n\n// eslint-disable-next-line import/order\nvar config = require(\"../config\");\nvar https = /^http:/.test(config().upload_prefix) ? require('http') : require('https');\nvar querystring = require(\"querystring\");\nvar Q = require('q');\nvar url = require('url');\nvar utils = require(\"../utils\");\nvar ensureOption = require('../utils/ensureOption').defaults(config());\nvar ProxyAgent = utils.optionalRequire('proxy-agent');\n\nvar extend = utils.extend,\n    includes = utils.includes,\n    isEmpty = utils.isEmpty;\n\n\nfunction execute_request(method, params, auth, api_url, callback) {\n  var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n  method = method.toUpperCase();\n  var deferred = Q.defer();\n\n  var query_params = void 0,\n      handle_response = void 0; // declare to user later\n  var key = auth.key;\n  var secret = auth.secret;\n  var oauth_token = auth.oauth_token;\n  var content_type = 'application/x-www-form-urlencoded';\n\n  if (options.content_type === 'json') {\n    query_params = JSON.stringify(params);\n    content_type = 'application/json';\n  } else {\n    query_params = querystring.stringify(params);\n  }\n\n  if (method === \"GET\") {\n    api_url += \"?\" + query_params;\n  }\n\n  var request_options = url.parse(api_url);\n\n  request_options = extend(request_options, {\n    method: method,\n    headers: {\n      'Content-Type': content_type,\n      'User-Agent': utils.getUserAgent()\n    }\n  });\n\n  if (oauth_token) {\n    request_options.headers.Authorization = `Bearer ${oauth_token}`;\n  } else {\n    request_options.auth = key + \":\" + secret;\n  }\n\n  if (options.agent != null) {\n    request_options.agent = options.agent;\n  }\n\n  var proxy = options.api_proxy || config().api_proxy;\n  if (!isEmpty(proxy)) {\n    if (!request_options.agent) {\n      if (ProxyAgent === null) {\n        throw new Error(\"Proxy value is set, but `proxy-agent` is not installed, please install `proxy-agent` module.\");\n      }\n      request_options.agent = new ProxyAgent(proxy);\n    } else {\n      console.warn(\"Proxy is set, but request uses a custom agent, proxy is ignored.\");\n    }\n  }\n  if (method !== \"GET\") {\n    request_options.headers['Content-Length'] = Buffer.byteLength(query_params);\n  }\n  handle_response = function handle_response(res) {\n    if (includes([200, 400, 401, 403, 404, 409, 420, 500], res.statusCode)) {\n      var buffer = \"\";\n      var error = false;\n      res.on(\"data\", function (d) {\n        buffer += d;\n        return buffer;\n      });\n      res.on(\"end\", function () {\n        var result = void 0;\n        if (error) {\n          return;\n        }\n        try {\n          result = JSON.parse(buffer);\n        } catch (e) {\n          result = {\n            error: {\n              message: \"Server return invalid JSON response. Status Code \" + res.statusCode\n            }\n          };\n        }\n\n        if (result.error) {\n          result.error.http_code = res.statusCode;\n        } else {\n          result.rate_limit_allowed = parseInt(res.headers[\"x-featureratelimit-limit\"]);\n          result.rate_limit_reset_at = new Date(res.headers[\"x-featureratelimit-reset\"]);\n          result.rate_limit_remaining = parseInt(res.headers[\"x-featureratelimit-remaining\"]);\n        }\n\n        if (result.error) {\n          deferred.reject(Object.assign({\n            request_options,\n            query_params\n          }, result));\n        } else {\n          deferred.resolve(result);\n        }\n        if (typeof callback === \"function\") {\n          callback(result);\n        }\n      });\n      res.on(\"error\", function (e) {\n        error = true;\n        var err_obj = {\n          error: {\n            message: e,\n            http_code: res.statusCode,\n            request_options,\n            query_params\n          }\n        };\n        deferred.reject(err_obj.error);\n        if (typeof callback === \"function\") {\n          callback(err_obj);\n        }\n      });\n    } else {\n      var err_obj = {\n        error: {\n          message: \"Server returned unexpected status code - \" + res.statusCode,\n          http_code: res.statusCode,\n          request_options,\n          query_params\n        }\n      };\n      deferred.reject(err_obj.error);\n      if (typeof callback === \"function\") {\n        callback(err_obj);\n      }\n    }\n  };\n\n  var request = https.request(request_options, handle_response);\n  request.on(\"error\", function (e) {\n    deferred.reject(e);\n    return typeof callback === \"function\" ? callback({ error: e }) : void 0;\n  });\n  request.setTimeout(ensureOption(options, \"timeout\", 60000));\n  if (method !== \"GET\") {\n    request.write(query_params);\n  }\n  request.end();\n  return deferred.promise;\n}\n\nmodule.exports = execute_request;"],"mappings":"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"},"metadata":{},"sourceType":"script"}